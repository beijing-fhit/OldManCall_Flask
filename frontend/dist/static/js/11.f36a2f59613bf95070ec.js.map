{"version":3,"sources":["webpack:///./src/utils.js","webpack:///src/components/auth.vue","webpack:///./src/components/auth.vue?6318","webpack:///./src/components/auth.vue"],"names":["getUrlParam","name","reg","r","window","location","search","substr","match","unescape","auth","data","created","document","title","this","$route","meta","init","mounted","navigator","userAgent","onpageshow","e","persisted","performance","navigation","type","replace","href","split","console","log","methods","_this","sessionStorage","clear","openid","ucallfreeid","qrcodeid","from","setItem","api","verifyQrCodeActive","then","res","Code","ActiveState","$router","push","path","query","message","catch","err","code","getOpenId","redirectUrl","config","webHost","encodeUrl","encodeURI","url","_this2","that","status_code","openId","weChatState","_ref","asyncToGenerator_default","regenerator_default","a","mark","_callee","loading","wrap","_context","prev","next","Tel","UcallFreeId","modifyOpenid","NickName","Headurl","showLoading","getInfoByUCallId","_ref2","_ref2$data","statusCode","undefined","length","getItem","hideLoading","stop","_x","apply","arguments","text","$loading","lock","customClass","spinner","background","close","components_auth","render","_h","$createElement","_self","_c","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/11.f36a2f59613bf95070ec.js","sourcesContent":["export function getUrlParam (name) { // 获取url 参数\n  // return decodeURIComponent(\n  //   (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.href) || [, ''])[1].replace(/\\+/g, '%20')) || null\n  let reg = `(^|&)${name}=([^&]*)(&|$)`\n  let r = window.location.search.substr(1).match(reg)\n  if (r != null) {\n    return unescape(r[2])\n  }\n  return null\n}\n// // 截取code\n// export function getUrlParam (paramName) {\n//   /// 获取地址栏指定参数的值\n//   /// <param name=\"paramName\">参数名</param>\n//   // 获取url中跟在问号后面的部分\n//   var params = window.location.search\n//   // 检测参数是否存在\n//   if (params.indexOf(paramName) > -1) {\n//     var paramValue = ''\n//     paramValue = params.substring(params.indexOf(paramName), paramName.length + 1)\n//     // // 检测后面是否还有参数\n//     // if (paramValue.indexOf('&') > -1) {\n//     //   // 去除后面多余的参数, 得到最终 paramName=paramValue 形式的值\n//     //   paramValue = paramValue.substring(0, paramValue.indexOf('&'))\n//     //   // 去掉参数名, 得到最终纯值字符串\n//     //   paramValue = paramValue.replace(paramName + '=', '')\n//     //   return paramValue\n//     // }\n//     return paramValue\n//   }\n// }\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","<template>\n  <div></div>\n</template>\n\n<script>\nimport {getUrlParam} from '../utils'\nimport api from '../api'\nimport {service} from '../config'\n\nexport default {\n  name: 'auth',\n  data () {\n    return {\n    }\n  },\n  created () {\n    document.title = this.$route.meta.title\n    this.init()\n  },\n  mounted () {\n    // 这部分代码是为了解决在ios上页面返回时不刷新的问题--start\n    let u = navigator.userAgent\n    let isiOS = !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/) // ios终端\n    if (isiOS) {\n      window.onpageshow = function (e) {\n        if (\n          e.persisted ||\n          (window.performance && window.performance.navigation.type === 2)\n        ) {\n          window.location.replace(window.location.href.split('?')[0])\n          console.log(window.location.href.split('?')[0])\n          // this.$router.replace('/auth')\n          // window.location.reload()\n        }\n      }\n    }\n    // 这部分代码是为了解决在ios上页面返回时不刷新的问题--end\n  },\n  methods: {\n    init: function () {\n      sessionStorage.clear()\n      // 截取路径上的参数，若含有openID和ucallfreeid和qrcodeid则表示从小程序过来的，\n      // 若没有openID这些参数，则表示从微信网页打开，则需要获取code和openID(判断参数中是否有code这个参数，若有则用来换取openID，若没有则先获取code)\n      // let params = window.location.search\n      let openid = getUrlParam('openid')\n      let ucallfreeid = getUrlParam('ucallfreeid')\n      let qrcodeid = getUrlParam('qrcodeid')\n      let from = getUrlParam('from')\n      if (openid && ucallfreeid && qrcodeid) {\n        // 来自小程序，则不用请求参数,跳转到call页面\n        sessionStorage.setItem('openId', openid)\n        sessionStorage.setItem('UcallFreeId', ucallfreeid)\n        sessionStorage.setItem('qrCodeId', qrcodeid)\n        api.verifyQrCodeActive(qrcodeid).then(res => {\n          if (res.data.Code === 0) {\n            if (res.data.ActiveState === 0) {\n              // 未激活\n              // 跳转到infodisplay页面，展示提示信息\n              this.$router.push({path: '/info', query: {message: '二维码未激活，请前往公众号激活!'}})\n            } else {\n              // 已激活\n              this.$router.push('/call')\n            }\n          }\n        }).catch(err => {\n          this.$router.push({path: '/info', query: {message: err}})\n        })\n      } else {\n        // 来自网页\n        let code = getUrlParam('code')\n        if (code) {\n          // 记录是否是管理员登录\n          if (from) {\n            sessionStorage.setItem('from', from)\n          }\n          // 若参数中有code，直接来换取openID\n          console.log('code' + code)\n          this.getOpenId(code)\n        } else {\n          // 若没有参数，则先获取code，回掉地址填本地址\n          let url = 'https://agency.ucallclub.com/wechart/Oauth2?'\n          let redirectUrl = service.webHost + (from ? '?from=' + from : '')\n          let a = 'redirect_uri='\n          let encodeUrl = encodeURI(redirectUrl)\n          window.location.href = url + a + encodeUrl\n        }\n      }\n    },\n    getOpenId: function (code) {\n      let that = this\n      api.getOpenId(code).then(res => {\n        console.log('在app.vue中获取openid成功:', res)\n        if (res.data.status_code === 0) {\n          let openId = res.data.data\n          sessionStorage.setItem('openId', openId)\n          // 获取用户状态，保存其中的ucallfreeid\n          api.weChatState(openId).then(async res => {\n            // console.log('weChatState', res)\n            sessionStorage.setItem('Tel', res.data.Tel[0])\n            sessionStorage.setItem('UcallFreeId', res.data.UcallFreeId)\n            await api.modifyOpenid(openId, res.data.UcallFreeId, res.data.NickName, '', res.data.Headurl)\n            // 查询是否有二维码，若没有，进入申请页面，若有则进入scan\n            let loading = that.showLoading()\n            api.getInfoByUCallId(res.data.UcallFreeId)\n              .then(({data: {statusCode, data}}) => {\n                if (statusCode === 0 && data !== null && data !== undefined && data.length !== 0) {\n                  this.$router.push('/scan')\n                } else {\n                  if (sessionStorage.getItem('from') === 'admin') {\n                    this.$router.replace('/scan')\n                  } else {\n                    this.$router.replace('/applycard')\n                  }\n                }\n                that.hideLoading(loading)\n              })\n          }).catch(res => {\n            console.log('webChatState error', res)\n          })\n        } else {\n          // 提示信息\n          console.log(res.data.message)\n        }\n      }).catch(res => {\n        console.log('在app.vue中获取openid失败:', res)\n      })\n    },\n    showLoading: function (text) {\n      return this.$loading({\n        lock: true,\n        customClass: 'create-isLoading', //  *这里设置他的class名称,这里最重要\n        text: text,\n        spinner: 'el-icon-loading',\n        background: 'rgba(0, 0, 0, 0)'\n      })\n    },\n    hideLoading: function (loading) {\n      loading.close()\n      // this.reload()\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/auth.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1dda4d38\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/auth.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1dda4d38\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./auth.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./auth.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./auth.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1dda4d38\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./auth.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-1dda4d38\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/auth.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}
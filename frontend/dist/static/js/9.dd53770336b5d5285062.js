webpackJsonp([9],{bvl0:function(t,e){},zetg:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("mvHQ"),a=n.n(o),s=n("looZ"),i=n("n5Qe"),l={inject:["reload"],name:"settings",components:{Topbar:s.a},data:function(){return{diseases:["无","高血压","高血脂","冠心病","脑中风","支气管哮喘","慢性支气管炎","老年痴呆","其他"],blood_select:["A","B","AB","O","其他"],manInfo:this.getManInfo(),text1:"请输入手机号码",text2:"请输入手机号码",showContact2Delete:!1,showContact3Delete:!1,contact:this.getContact(),centerDialogVisible:!1,isModified:!1}},created:function(){document.title=this.$route.meta.title},mounted:function(){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(window.onpageshow=function(t){(t.persisted||window.performance&&2===window.performance.navigation.type)&&window.location.reload()});var t=this,e=!0,n=this.$route.query.getPhoneNumberFromNet;if(null!==n&&void 0!==n&&""!==n&&"undefined"!==n&&(e=JSON.parse(n)),!1===e)try{return this.manInfo=this.getManInfo(),void(this.contact=this.getContact())}catch(t){return void console.log("获取s异常:",t)}i.a.getInfo(sessionStorage.getItem("qrCodeId")).then(function(e){if(0===e.data.status_code){var n=e.data.data;t.manInfo.name=n.old_man_info.name,t.manInfo.age=n.old_man_info.age.toString(),t.manInfo.address=n.old_man_info.address,""===n.old_man_info.medical_history.trim()?t.manInfo.medical_history=[]:t.manInfo.medical_history=n.old_man_info.medical_history.split(","),t.manInfo.allergy=n.old_man_info.allergy,t.manInfo.blood_type=n.old_man_info.blood_type,t.manInfo.drugs=n.old_man_info.drugs,t.manInfo.treatment=n.old_man_info.treatment,t.manInfo.message=n.old_man_info.message,sessionStorage.setItem("manInfo",a()(t.manInfo)),sessionStorage.setItem("contact",t.generatePhoneStr(n.phone_number)),t.contact=t.getContact()}})},methods:{routeToCallUpdatePage:function(){this.$router.push("/updateNumber")},generatePhoneStr:function(t){for(var e="",n=0;n<t.length;n++){e+=t[n]+","}return e=e.substr(0,e.length-1)},getleagalContact:function(t){for(var e=[],n=0,o=t,a=0;a<o.length;a++)null!==o[a]&&""!==o[a]&&void 0!==o[a]&&"undefined"!==o[a]&&(e[n]=o[a],n++);return e},getManInfo:function(){var t={name:"",address:"",age:"",medical_history:"",allergy:"",blood_type:"",drugs:"",treatment:"",message:""},e=sessionStorage.getItem("manInfo");if(null!==e&&void 0!==e&&""!==e&&"undefined"!==e){var n=JSON.parse(e);t.name=n.name,null!==n.age&&"null"!==n.age&&void 0!==n.age&&"undefined"!==n.age&&""!==n.age?t.age=n.age.toString():t.age="",t.address=n.address,n.medical_history instanceof Array?t.medical_history=n.medical_history:""===n.medical_history.trim()?t.medical_history=[]:t.medical_history=n.medical_history.split(","),t.allergy=n.allergy,t.blood_type=n.blood_type,t.drugs=n.drugs,t.treatment=n.treatment,t.message=n.message}return t},getContact:function(){if(null!==sessionStorage.getItem("contact")){var t=sessionStorage.getItem("contact").split(","),e=0;for(var n in t){var o=t[n];console.log(o),""!==o&&void 0!==o&&null!==o&&"undefined"!==o&&e++}switch(console.log("contact length:",e),e){case 1:this.showContact2Delete=!1,this.showContact3Delete=!1;break;case 2:this.showContact2Delete=!0,this.showContact3Delete=!1;break;case 3:this.showContact2Delete=!0,this.showContact3Delete=!0;break;default:this.showContact2Delete=!1,this.showContact3Delete=!1}return console.log("contact length2:",e),console.log("showContactNDelete:",this.showContact2Delete,this.showContact3Delete),t}return[]},modifyContact:function(t){0!==t&&(2!==t||""!==this.contact[1]&&void 0!==this.contact[1]?(sessionStorage.setItem("manInfo",a()(this.manInfo)),this.$router.push({path:"/addContact",query:{modifyNumber:this.contact[t],index:t,mode:""===this.contact[t]?1:0}})):this.$toast("请先绑定第二个联系人！"))},deleteContact:function(t){this.contact[t]="",sessionStorage.setItem("contact",this.generatePhoneStr(this.contact)),this.contact=this.getContact(),this.reload()},saveInfo:function(){var t=this;if(0===this.manInfo.name.length)return this.$toast("姓名不能为空!"),void window.location.reload();var e=sessionStorage.getItem("qrCodeId"),n=sessionStorage.getItem("UcallFreeId"),o=a()(this.manInfo),s=JSON.parse(o);s.age=parseInt(s.age),s.medical_history=s.medical_history.toString();var l=this.getleagalContact(this.contact);sessionStorage.setItem("manInfo",a()(s)),i.a.saveInfo(e,n,s,l).then(function(n){0===n.data.status_code?0===sessionStorage.getItem("isQrCodeActive")||"0"===sessionStorage.getItem("isQrCodeActive")?i.a.activateQrCode(sessionStorage.getItem("openId"),e,sessionStorage.getItem("UcallFreeId")).then(function(e){0===e.data.Code?(t.$toast("激活二维码成功"),t.centerDialogVisible=!0,console.log("激活二维码成功:",e)):(t.$toast("激活二维码失败"),window.location.reload(),console.log("激活二维码失败1:",e))}).catch(function(e){t.$toast("激活二维码失败"),window.location.reload(),console.log("激活二维码失败2:",e)}):(t.$toast("保存信息成功"),console.log("保存信息成功:"),t.centerDialogVisible=!0):(t.$toast("保存信息失败"),console.log("保存信息失败1:"),window.location.reload())}).catch(function(e){console.log("保存信息失败2:",e),t.$toast("保存信息失败!"),window.location.reload(),t.centerDialogVisible=!1})},dialogConfirm:function(){this.centerDialogVisible=!1,window.scrollTo({top:0,left:0,behavior:"smooth"}),setTimeout(function(){window.location.reload()},500)}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",[n("Topbar",{staticClass:"topbar",attrs:{"show-save-btn":!0},on:{saveInfo:t.saveInfo}}),t._v(" "),n("el-row",{staticClass:"alert-row margin-horizontal"},[t._v("注意保存信息!")])],1),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"contact-panel"},[n("el-row",{staticClass:"contact-item border-bottom"},[n("span",{staticClass:"contact-name"},[t._v("联系人1")]),t._v(" "),n("span",{staticClass:"contact-number"},[t._v(t._s(void 0===t.contact[0]||"undefined"===t.contact[0]||null===t.contact[0]||""===t.contact[0]?t.text1:t.contact[0]))]),t._v(" "),n("span",{staticClass:"delete-img"})]),t._v(" "),n("el-row",{staticClass:"contact-item border-bottom"},[n("span",{staticClass:"contact-name"},[t._v("联系人2")]),t._v(" "),n("span",{staticClass:"contact-number",on:{click:function(e){return t.modifyContact(1)}}},[t._v(t._s(void 0===t.contact[1]||"undefined"===t.contact[1]||null===t.contact[1]||""===t.contact[1]?t.text1:t.contact[1]))]),t._v(" "),n("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info",iconColor:"red",title:"删除该联系人吗？"},on:{onConfirm:function(e){return t.deleteContact(1)}}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.showContact2Delete,expression:"showContact2Delete"}],staticClass:"el-icon-delete delete-img",attrs:{slot:"reference"},slot:"reference"})])],1),t._v(" "),n("el-row",{staticClass:"contact-item"},[n("span",{staticClass:"contact-name"},[t._v("联系人3")]),t._v(" "),n("span",{staticClass:"contact-number",on:{click:function(e){return t.modifyContact(2)}}},[t._v(t._s(void 0===t.contact[2]||"undefined"===t.contact[2]||null===t.contact[2]||""===t.contact[2]?t.text1:t.contact[2]))]),t._v(" "),n("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info",iconColor:"red",title:"删除该联系人吗？"},on:{onConfirm:function(e){return t.deleteContact(2)}}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.showContact3Delete,expression:"showContact3Delete"}],staticClass:"el-icon-delete delete-img",attrs:{slot:"reference"},slot:"reference"})])],1)],1),t._v(" "),t._m(1),t._v(" "),n("div",{staticClass:"info-fill-panel leftpadding"},[n("el-row",{staticClass:"info-item border-bottom "},[n("span",{staticClass:"info-name"},[t._v("姓名*")]),t._v(" "),n("el-input",{staticClass:"info-content normal-input-style ",attrs:{maxlength:"10",placeholder:"预设内容(必填)",clearable:""},model:{value:t.manInfo.name,callback:function(e){t.$set(t.manInfo,"name",e)},expression:"manInfo.name"}})],1),t._v(" "),n("el-row",{staticClass:"info-item border-bottom "},[n("span",{staticClass:"info-name"},[t._v("地址")]),t._v(" "),n("el-input",{staticClass:"info-content normal-input-style ",attrs:{maxlength:"30",placeholder:"预设内容",clearable:""},model:{value:t.manInfo.address,callback:function(e){t.$set(t.manInfo,"address",e)},expression:"manInfo.address"}})],1)],1),t._v(" "),n("el-row",{staticClass:"info-item border-bottom leftpadding white-bg"},[n("span",{staticClass:"info-name"},[t._v("出生年份")]),t._v(" "),n("el-date-picker",{staticClass:"info-content normal-input-style ",attrs:{type:"year","default-value":"2020",format:"yyyy","value-format":"yyyy",placeholder:"请选择年份"},model:{value:t.manInfo.age,callback:function(e){t.$set(t.manInfo,"age",e)},expression:"manInfo.age"}})],1),t._v(" "),n("div",{staticClass:"info-fill-panel leftpadding"},[n("el-row",{staticClass:"info-item-height-wrap-content border-bottom"},[n("span",{staticClass:"info-name"},[t._v("病史")]),t._v(" "),n("el-select",{staticClass:"info-content normal-input-style ",attrs:{"allow-create":"",filterable:"",multiple:"",placeholder:"请输入病史"},model:{value:t.manInfo.medical_history,callback:function(e){t.$set(t.manInfo,"medical_history",e)},expression:"manInfo.medical_history"}},t._l(t.diseases,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),n("el-row",{staticClass:"info-item border-bottom"},[n("span",{staticClass:"info-name"},[t._v("过敏史")]),t._v(" "),n("el-input",{staticClass:"info-content normal-input-style ",attrs:{placeholder:"预设内容",clearable:""},model:{value:t.manInfo.allergy,callback:function(e){t.$set(t.manInfo,"allergy",e)},expression:"manInfo.allergy"}})],1)],1),t._v(" "),n("el-row",{staticClass:"info-item border-bottom leftpadding white-bg"},[n("span",{staticClass:"info-name"},[t._v("血型")]),t._v(" "),n("el-select",{staticClass:"info-content normal-input-style ",attrs:{placeholder:"请选择血型",clearable:""},model:{value:t.manInfo.blood_type,callback:function(e){t.$set(t.manInfo,"blood_type",e)},expression:"manInfo.blood_type"}},t._l(t.blood_select,function(t){return n("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),n("div",{staticClass:"info-fill-panel leftpadding "},[n("el-row",{staticClass:"info-item-height-wrap-content border-bottom"},[n("span",{staticClass:"long-info-name"},[t._v("正在吃的药")]),t._v(" "),n("el-input",{staticClass:"long-info-content normal-input-style",attrs:{maxlength:"30",type:"textarea",autosize:"",placeholder:"预设内容",clearable:""},model:{value:t.manInfo.drugs,callback:function(e){t.$set(t.manInfo,"drugs",e)},expression:"manInfo.drugs"}})],1),t._v(" "),n("el-row",{staticClass:"info-item-height-wrap-content"},[n("span",{staticClass:"long-info-name"},[t._v("正在进行的治疗")]),t._v(" "),n("el-input",{staticClass:"long-info-content normal-input-style",attrs:{maxlength:"30",type:"textarea",autosize:"",placeholder:"预设内容",clearable:""},model:{value:t.manInfo.treatment,callback:function(e){t.$set(t.manInfo,"treatment",e)},expression:"manInfo.treatment"}})],1),t._v(" "),n("el-row",{staticClass:"info-item-height-wrap-content"},[n("span",{staticClass:"info-name"},[t._v("弹窗提醒")]),t._v(" "),n("el-input",{staticClass:"input-style-textarea",attrs:{type:"textarea",autosize:"",maxlength:"100",minline:"2",placeholder:"此信息用于弹窗提醒，请填写一些救助预案"},model:{value:t.manInfo.message,callback:function(e){t.$set(t.manInfo,"message",e)},expression:"manInfo.message"}})],1)],1),t._v(" "),n("el-button",{staticClass:"wide-button",attrs:{type:"success"},on:{click:t.saveInfo}},[t._v("保存")]),t._v(" "),n("el-dialog",{attrs:{"lock-scroll":!1,visible:t.centerDialogVisible,title:"操作成功",width:"80%","show-close":!1,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[n("span",{staticClass:"center-dialog-content"},[t._v("你的信息已经保存!")]),t._v(" "),n("span",{staticClass:"dialog-footer dialog-btn-group",attrs:{slot:"footer"},slot:"footer"},[n("span",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:t.dialogConfirm}},[t._v("确定")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-title"},[e("span",{staticClass:"title-text"},[this._v("联系人号码绑定/修改")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-title border-bottom"},[e("span",{staticClass:"title-text"},[this._v("信息填写")])])}]};var r=n("VU/8")(l,c,!1,function(t){n("bvl0")},"data-v-624dcb3e",null);e.default=r.exports}});
//# sourceMappingURL=9.dd53770336b5d5285062.js.map
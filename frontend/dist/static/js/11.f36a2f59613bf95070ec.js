webpackJsonp([11],{IPwc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),o=a.n(n),r=a("exGp"),i=a.n(r);function s(e){var t="(^|&)"+e+"=([^&]*)(&|$)",a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}var c=a("n5Qe"),d=a("QmSG"),l={name:"auth",data:function(){return{}},created:function(){document.title=this.$route.meta.title,this.init()},mounted:function(){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(window.onpageshow=function(e){(e.persisted||window.performance&&2===window.performance.navigation.type)&&(window.location.replace(window.location.href.split("?")[0]),console.log(window.location.href.split("?")[0]))})},methods:{init:function(){var e=this;sessionStorage.clear();var t=s("openid"),a=s("ucallfreeid"),n=s("qrcodeid"),o=s("from");if(t&&a&&n)sessionStorage.setItem("openId",t),sessionStorage.setItem("UcallFreeId",a),sessionStorage.setItem("qrCodeId",n),c.a.verifyQrCodeActive(n).then(function(t){0===t.data.Code&&(0===t.data.ActiveState?e.$router.push({path:"/info",query:{message:"二维码未激活，请前往公众号激活!"}}):e.$router.push("/call"))}).catch(function(t){e.$router.push({path:"/info",query:{message:t}})});else{var r=s("code");if(r)o&&sessionStorage.setItem("from",o),console.log("code"+r),this.getOpenId(r);else{var i=d.a.webHost+(o?"?from="+o:""),l=encodeURI(i);window.location.href="https://agency.ucallclub.com/wechart/Oauth2?redirect_uri="+l}}},getOpenId:function(e){var t=this,a=this;c.a.getOpenId(e).then(function(e){if(console.log("在app.vue中获取openid成功:",e),0===e.data.status_code){var n=e.data.data;sessionStorage.setItem("openId",n),c.a.weChatState(n).then((r=i()(o.a.mark(function e(r){var i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return sessionStorage.setItem("Tel",r.data.Tel[0]),sessionStorage.setItem("UcallFreeId",r.data.UcallFreeId),e.next=4,c.a.modifyOpenid(n,r.data.UcallFreeId,r.data.NickName,"",r.data.Headurl);case 4:i=a.showLoading(),c.a.getInfoByUCallId(r.data.UcallFreeId).then(function(e){var n=e.data,o=n.statusCode,r=n.data;0===o&&null!==r&&void 0!==r&&0!==r.length?t.$router.push("/scan"):"admin"===sessionStorage.getItem("from")?t.$router.replace("/scan"):t.$router.replace("/applycard"),a.hideLoading(i)});case 6:case"end":return e.stop()}},e,t)})),function(e){return r.apply(this,arguments)})).catch(function(e){console.log("webChatState error",e)})}else console.log(e.data.message);var r}).catch(function(e){console.log("在app.vue中获取openid失败:",e)})},showLoading:function(e){return this.$loading({lock:!0,customClass:"create-isLoading",text:e,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"})},hideLoading:function(e){e.close()}}},u={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]};var f=a("VU/8")(l,u,!1,function(e){a("t6nL")},"data-v-1dda4d38",null);t.default=f.exports},t6nL:function(e,t){}});
//# sourceMappingURL=11.f36a2f59613bf95070ec.js.map